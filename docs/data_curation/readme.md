# Method for creating POPS, PROFILE and POCKETS for Graphsite

* Cavity center with their respective PDB IDs are given in cavity_centers.csv
* All the data were created using python3.8

## **Steps**

### 1. Download PDBs
* Using RSCB PDB batch download services download files. (https://www.rcsb.org/downloads)
  * Files will be downloaded as *.ent.gz  
  ```
  unzip *.ent.gz -d path_to_extract_directory
  mv file.ent pathto_files/file.pdb
  ```

### 2. Separate PDB chains into different PDBs and renumber residues
* ```separate_pdb_chains.py``` will separate PDB chains into different PDB files
* ```renumber.py``` will renumber residues in PDB files. Note that ```renumber.py``` will delete files that could not be renumbered.   
  ```
  mkdir PDB_CHAINS
  python separate_pdb_chains.py
  python renumber.py
  ```
* Note: Please ensure installation of pdbtools in the system before the use of ```separate_pdb_chains.py```

### 3. Run POPScomp
* Use chain PDB files to run POPScomp 
  ```
  cd PDB_CHAINS
  for file in *.pdb; do pops --pdb $file --atomOut --popsOut $file.pops; done
  ```
* Note: Please ensure installation of POPScomp in the system before the use of ```pops```

### 4. Convert PDB to FASTA
* This script converts PDB to FASTA
  ```
  python pdb2seq.py
  ```

### 5. Run PROFILpro 1.2
* This program uses the FASTA sequences as input and generates protein PROFILES
* SCRATCH-1D_1.3 can be downloaded from https://download.igb.uci.edu
  * num_rounds are limited to either 2, 3 or 4
  * num_threads: default 4
  ```
  for file in *.fa; do sh SCRATCH-1D_1.3/pkg/PROFILpro_1.2/bin/generate_profiles.sh $file $file.profile num_rounds num_threads; done
  ```

### 6. Calculate POCKETS
* FPOCKET 4.0 uses PDB files to find all pockets in a protein
* FPOCKET generates file_out folder for each of the PDBs
* POCKET PDBs generated by FPOCKET can be found in **file_out/pockets**
  ```
  for file in *.pdb; do fpocket -f $file; done
  ```

### 7. Transform the POCKETS
* **Create POCKETS_UNTRANSFORMED**
* **Move all the POCKET PDBs generated by FPOCKET into POCKETS_UNTRANSFORMED**
* This script aligns POCKET center to origin (0, 0, 0) and aligns principal axes with eigen vectors
  ```
  mkdir POCKETS_TRANSFORMED
  python rotate_translate.py
  ```

### 8. Convert POCKET PDBs to MOL2
* Convert POCKET PDBs to MOL2 using **obabel 3.1.1**
  ```
  cd POCKETS_TRANSFORMED
  for v in *_rot.pdb; do obabel -ipdb $v -omol2 -gen3d -O$v.mol2; done
  mkdir POCKETS_TRANSFORMED_MOL2
  mv *.mol2 POCKETS_TRANSFORMED_MOL2
  ```
 
 # Prerequisites
 - python3.7+
 - biopython (https://github.com/biopython/biopython)
 - biopandas (https://pypi.org/project/biopandas/)
 - POPScomp 3.1.7 (https://github.com/Fraternalilab/POPScomp/wiki/Installation)
 - SCRATCH-1D_1.3 (https://download.igb.uci.edu)
 - pdbtools (http://www.bonvinlab.org/pdb-tools/)
