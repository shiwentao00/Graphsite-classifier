# Method for creating POPS, PROFILE and POCKETS for Graphsite

* Cavity center with their respective PDB IDs are given in cavity_centers.csv
* All the data were created using python3.8

## **Steps**

### 1. Download PDBs
* Using RSCB PDB batch download services download files. (https://www.rcsb.org/downloads)
  * Files will be downloaded as *.ent.gz  
  ```
  unzip *.ent.gz -d path_to_extract_directory
  mv file.ent pathto_files/file.pdb
  ```

### 2. Separate PDB chains into different PDBs and renumber residues
* ```separate_pdb_chains.py``` will separate PDB chains into different PDB files
* ```renumber.py``` will renumber residues in PDB files. Note that ```renumber.py``` will delete files that could not be renumbered.   
  ```
  mkdir PDB_CHAINS
  python separate_pdb_chains.py
  python renumber.py
  ```

### 3. Run POPScomp
* Script below uses only ATOM from PDB to create POPS
* Only PDBs mentioned in the **cavity_centers.csv** will be kept for further analysis. 
  ```
  python run_pops.py
  ```

### 4. Convert PDB to FASTA
* This script converts PDB to FASTA
  ```
  python pdb2seq.py
  ```

### 5. RUN PROFILpro 1.2
* This program uses the FASTA sequences as input and generates protein PROFILES
* SCRATCH-1D_1.3 can be downloaded from https://download.igb.uci.edu
* num_rounds are limited to either 2, 3 or 4
* num_threads: default 4
  ```
  for file in *.fa; do sh SCRATCH-1D_1.3/pkg/PROFILpro_1.2/bin/generate_profiles.sh $file $file.profile num_rounds num_threads; done
  ```

### 6. Calculate POCKETS
* FPOCKET 4.0 uses PDB files to find all pockets in a protein
* FPOCKET generates file_out folder for each of the PDBs
* POCKETS generated by FPOCKET can be found in "file_out/pockets"
  ```
  for file in *.pdb; do fpocket -f $file; done
  ```
### 7. Transform the POCKET
* **Create POCKETS_UNTRANSFORMED**
* **Move all the POCKETS generated by FPOCKET into POCKETS_UNTRANSFORMED** 

* This script aligns POCKET center to origin (0, 0, 0) and aligns principal axes with eigen vectors
  ```
  mkdir POCKETS_TRANSFORMED
  python rotate_translate.py
  ```

### 8. Convert POCKET PDBs to MOL2
* convert POCKET PDBs to MOL2 uing *obabel 3.1.1*
  ```
  cd POCKETS_TRANSFORMED
  for v in *_rot.pdb; do obabel -ipdb $v -omol2 -gen3d -O$v.mol2; done
  mkdir POCKETS_TRANSFORMED_MOL2
  mv *.mol2 POCKETS_TRANSFORMED_MOL2
  ```
 
 # Prerequisites
 - python3.7+
 - biopython (https://github.com/biopython/biopython)
 - biopandas (https://pypi.org/project/biopandas/)
